name: Generate KenPom Plot Only

on:
  workflow_dispatch:  # Allows manual trigger from GitHub UI

jobs:
  generate-plot:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up R
      uses: r-lib/actions/setup-r@v2
      with:
        r-version: '4.x'
    
    - name: Install required R packages
      run: |
        Rscript -e 'install.packages(c("tidyverse", "ggimage", "scales"), repos="https://cloud.r-project.org")'

    - name: Generate plots
      run: |
        Rscript generate_kenpom_plot.R

    - name: Upload plots as artifacts
      uses: actions/upload-artifact@v3
      with:
        name: plots
        path: plots/

    - name: Commit and push plots
      run: |
        git config --local user.email "actions@github.com"
        git config --local user.name "GitHub Actions"
        git add plots/
        git commit -m "Update plots (generated at $(date -u +'%Y-%m-%d %H:%M:%S UTC'))" || echo "No changes to commit"
        git push
