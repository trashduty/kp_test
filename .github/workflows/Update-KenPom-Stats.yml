name: Update KenPom Stats

on:
  schedule:
    # Runs daily at 6 AM UTC (adjust as needed)
    - cron: '0 6 * * *'
  workflow_dispatch:  # Allows manual triggering from Actions tab

jobs:
  update-stats:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install requests python-dotenv
      
      - name: Run scraper script
        env:
          KENPOM_API_KEY: ${{ secrets.KENPOM_API_KEY }}
        run: |
          python scrape_kenpom_stats.py
      
      - name: üíæ Commit files to repo
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          # Add all changes
          git add -A
          
          # Check if there are changes to commit
          if git diff-index --quiet HEAD --; then
            echo "‚úÖ No changes to commit"
          else
            echo "üìù Changes detected, committing..."
            git commit -m "ü§ñ Update KenPom stats [skip ci] ($(date -u +'%Y-%m-%d %H:%M:%S UTC'))"
            
            # Try to push, if it fails pull and merge
            if ! git push origin main; then
              echo "‚ö†Ô∏è Push failed, pulling latest changes..."
              git pull --no-rebase origin main
              git push origin main
            fi
            echo "‚úÖ Changes pushed successfully"
          fi
